<!DOCTYPE html>
<html>
<head>
    <title>Release Burndown</title>

    <script type="text/javascript" src="/apps/x/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.DateMixin",{dateFormatters:[{key:"MMM",value:"%b"},{key:"MM",value:"%m"},{key:"dd",value:"%d"},{key:"yyyy",value:"%Y"}],dateToStringDisplay:function(date){return Ext.Date.format(date,"m/d/Y")},dateToString:function(date){return Ext.Date.format(date,"Y-m-d\\TH:i:s.u\\Z")},dateStringToObject:function(dateStr){var finalIndex=dateStr.indexOf("T"),dateObj;return finalIndex>-1&&(dateStr=dateStr.slice(0,dateStr.indexOf("T"))),dateObj=this._splitDateParts(dateStr),new Date(dateObj.year,dateObj.month,dateObj.day)},_splitDateParts:function(dateStr){return this._shouldSplitOnDash(dateStr)?this._objectFromYearFirstDate(dateStr.split("-")):this._objectFromMonthFirstDate(dateStr.split("/"))},_objectFromYearFirstDate:function(dateArray){return 3!==dateArray.length?{year:0,month:0,day:0}:(dateArray[1]=""+(parseInt(dateArray[1],10)-1),{year:dateArray[0],month:dateArray[1],day:dateArray[2]})},_objectFromMonthFirstDate:function(dateArray){return 3!==dateArray.length?{year:0,month:0,day:0}:(dateArray[0]=""+(parseInt(dateArray[0],10)-1),{month:dateArray[0],day:dateArray[1],year:dateArray[2]})},_shouldSplitOnDash:function(dateStr){return 3===dateStr.split("-").length}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.IntegrationHeaders",{keyConverters:{name:function(){return"X-RallyIntegrationName"},vendor:function(){return"X-RallyIntegrationVendor"},platform:function(){return"X-RallyIntegrationPlatform"},os:function(){return"X-RallyIntegrationOS"},version:function(){return"X-RallyIntegrationVersion"},library:function(){return"X-RallyIntegrationLibrary"}},constructor:function(config){this.headers={name:"A2 Chart",vendor:"Rally Software"},Ext.merge(this.headers,config.integrationHeaders||{}),this.callParent(config)},withName:function(nm){return this.headers.name=nm||this.headers.name,this},withVendor:function(v){return this.headers.vendor=v||this.headers.vendor,this},withPlatform:function(newPlatform){return this.headers.platform=newPlatform||this.headers.platform,this},withVersion:function(newVersion){return this.headers.version=newVersion||this.headers.version,this},withOS:function(newOS){return this.headers.os=newOS||this.headers.os,this},withLibrary:function(newLibrary){return this.headers.library=newLibrary||this.headers.library,this},applyTo:function(config){return config.headers=config.headers||{},Ext.merge(config.headers,this.build()),config},build:function(){var h={};for(var k in this.headers)if(this.headers.hasOwnProperty(k)){if(null===this.headers[k])continue;var key=this._keyConverter(k)(k);h[key]=this.headers[k]}return h},_keyConverter:function(key){return this.keyConverters.hasOwnProperty(key)?this.keyConverters[key]:function(x){return x}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.settings.RadioGroupSetting",{extend:"Ext.form.FieldContainer",config:{settingName:void 0},constructor:function(config){this.mergeConfig(config),this.callParent(arguments)},getSetting:function(){return this.settingsParent.app.getSetting(this.settingName)},setRadioValue:function(cmp){this.setRadioToCustomValue(cmp,this.getSetting())},setRadioToCustomValue:function(cmp,customValue){var value={};value[cmp.name]=customValue,cmp.setValue(value)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.settings.ChartDisplayTypePicker",{extend:"Rally.apps.charts.settings.RadioGroupSetting",alias:"widget.chartdisplaytypepicker",mixins:["Ext.form.field.Field"],config:{settingName:"chartDisplayType"},settingsParent:void 0,initComponent:function(){this.callParent(arguments),this.add(this._getPicker())},_getPicker:function(){return{xtype:"radiogroup",name:this.settingName,columns:[160,100],vertical:!1,items:[{boxLabel:"Line",name:this.settingName,inputValue:"line",checked:!0},{boxLabel:"Column",name:this.settingName,inputValue:"column"}],listeners:{beforerender:this.setRadioValue,scope:this}}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.settings.SettingsChangeMixin",{sendSettingsChange:function(artifact){this.settingsParent&&this.settingsParent.sendSettingsChange(artifact,this)},receiveSettingsChange:function(artifact){}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.settings.DataTypePicker",{extend:"Rally.apps.charts.settings.RadioGroupSetting",alias:"widget.chartdatatypepicker",mixins:["Ext.form.field.Field","Rally.apps.charts.settings.SettingsChangeMixin"],config:{settingName:"chartAggregationType"},settingsParent:void 0,initComponent:function(){this.callParent(arguments),this.add(this._addRadioGroup())},_addRadioGroup:function(){return{xtype:"radiogroup",name:this.settingName,columns:[160,100],vertical:!1,items:[{boxLabel:"Story Plan Estimate",name:this.settingName,inputValue:"storypoints",checked:!0},{boxLabel:"Story Count",name:this.settingName,inputValue:"storycount"}],listeners:{beforerender:this.setRadioValue,scope:this}}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.settings.TimeboxPicker",{extend:"Rally.apps.charts.settings.RadioGroupSetting",alias:"widget.charttimeboxpicker",mixins:["Ext.form.field.Field"],config:{settingName:"chartTimebox"},settingsParent:void 0,initComponent:function(){this.callParent(arguments),this._addRadioGroup()},_addRadioGroup:function(){this.add({xtype:"radiogroup",name:this.settingName,itemId:this.settingName,label:"Level",columns:[160,100,100],vertical:!1,items:[{boxLabel:"Release",name:this.settingName,inputValue:"release",checked:!0},{boxLabel:"Iteration",name:this.settingName,inputValue:"iteration"}],listeners:{beforerender:this.setRadioValue,scope:this},config:{cls:"levelchooser"}})}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.BannerWidget",{extend:"Ext.Component",alias:"widget.bannerwidget",config:{expanded:!0},cls:"stat-panel",data:{},tpl:['<div class="expanded-widget"></div>','<div class="collapsed-widget"></div>'],onRender:function(){this.expanded?this.removeCls("collapsed"):this.addCls("collapsed"),this.callParent(arguments)},expand:function(){this.removeCls("collapsed"),this.setExpanded(!0)},collapse:function(){this.addCls("collapsed"),this.setExpanded(!1)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.Gauge",{extend:"Rally.apps.iterationtrackingboard.statsbanner.BannerWidget",alias:"widget.statsbannergauge",requires:["Rally.ui.chart.Chart","Rally.util.Timebox","Rally.util.Colors"],config:{context:null,store:null},onDataChanged:Ext.emptyFn,getChartEl:Ext.emptyFn,_getChartConfig:Ext.emptyFn,_tzOffsetPromises:{},initComponent:function(){this.mon(this.store,"datachanged",this.onDataChanged,this),this.callParent(arguments)},expand:function(){this.callParent(),this.chart?this.chart.doLayout():this._addChart(this._getChartConfig({}))},onRender:function(){this.callParent(arguments),this.getContext().getTimeboxScope().getRecord()||this._addEmptyChart()},_addEmptyChart:function(){this._cleanupChart(),this._addChart({chartData:{series:[{data:[{name:"",y:100,color:Rally.util.Colors.grey1}]}]}})},_cleanupChart:function(){this.chart&&(this.chart.destroy(),delete this.chart)},onDestroy:function(){this._cleanupChart(),this.callParent(arguments)},onResize:function(){this.chart&&!this.getEl().up(".stats-banner.collapsed")&&this.chart.updateLayout(),this.callParent(arguments)},refreshChart:function(chartConfig){Ext.suspendLayouts(),this._cleanupChart(),this.rendered&&this.expanded&&this._addChart(chartConfig),Ext.resumeLayouts(),this.fireEvent("ready",this)},_addChart:function(chartConfig){var height=62;this.chart=Ext.create("Rally.ui.chart.Chart",Ext.apply({loadMask:!1,renderTo:this.getChartEl(),cls:"gauge",chartConfig:{chart:{backgroundColor:"rgba(255, 255, 255, 0.1)",defaultSeriesType:"pie",height:height,spacingTop:0,spacingRight:0,spacingBottom:0,spacingLeft:0},plotOptions:{pie:{borderWidth:0,center:["50%","50%"],dataLabels:{enabled:!1},size:height-4,innerSize:height-14,enableMouseTracking:!1,shadow:!1}},title:"",tooltip:{enabled:!1}}},chartConfig))},getTimeboxData:function(){return this._getTZOffset().then({success:function(tzOffset){var timebox=this.getContext().getTimeboxScope().getRecord();return timebox?Rally.util.Timebox.getCounts(timebox.get("StartDate"),timebox.get("EndDate"),this.getContext().getWorkspace().WorkspaceConfiguration.WorkDays,tzOffset):{remaining:0,workdays:0}},scope:this})},_getTZOffset:function(){var projectRef=Rally.util.Ref.getRelativeUri(this.getContext().getProject());if(!Ext.isDefined(this._tzOffsetPromises[projectRef])){var deferred=this._tzOffsetPromises[projectRef]=Ext.create("Deft.Deferred");Rally.environment.getIoProvider().httpGet({url:Rally.environment.getServer().getWsapiUrl()+"/iteration",params:{includeSchema:!0,pagesize:1,fetch:!1,project:projectRef},success:function(results){deferred.resolve((results.Schema.properties.EndDate.format.tzOffset||0)/60)},requester:this,scope:this})}return this._tzOffsetPromises[projectRef]},getAcceptanceData:function(){var scheduleStates=this.store.model.getField("ScheduleState").getAllowedStringValues(),acceptanceData={accepted:0,total:0},accepted=_.indexOf(scheduleStates,"Accepted");return _.each(this.store.getRange(),function(record){var estimate=record.get("PlanEstimate")||0;_.indexOf(scheduleStates,record.get("ScheduleState"))>=accepted&&(acceptanceData.accepted+=estimate),acceptanceData.total+=estimate},this),acceptanceData}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.PlannedVelocity",{extend:"Rally.apps.iterationtrackingboard.statsbanner.Gauge",alias:"widget.statsbannerplannedvelocity",require:["Rally.util.Colors"],tpl:['<div class="expanded-widget">','<div class="stat-title">Planned Velocity</div>','<div class="stat-metric">','<div class="metric-chart"></div>','<div class="metric-chart-text percent-offset">','{percentage}<div class="metric-percent">%</div>',"</div>",'<div class="metric-subtext">{estimate} of {plannedVelocity} {unit}</div>',"</div>","</div>",'<div class="collapsed-widget">','<div class="stat-title">Planned Velocity</div>','<div class="stat-metric">{percentage}<span class="metric-percent">%</span></div>',"</div>"],config:{data:{percentage:0,estimate:0,plannedVelocity:0,unit:""}},onDataChanged:function(){this._getRenderData().then({success:function(renderData){this.update(renderData),this.refreshChart(this._getChartConfig(renderData))},scope:this})},getChartEl:function(){return this.getEl().down(".metric-chart")},_getTimeboxUnits:function(){return"iteration"===this.getContext().getTimeboxScope().getType()?this.getContext().getWorkspace().WorkspaceConfiguration.IterationEstimateUnitName:this.getContext().getWorkspace().WorkspaceConfiguration.ReleaseEstimateUnitName},_getRenderData:function(){var deferred=Ext.create("Deft.Deferred"),estimate=_.reduce(this.store.getRange(),function(accum,record){return accum+record.get("PlanEstimate")||0},0);estimate=Math.round(100*estimate)/100;var timebox=this.getContext().getTimeboxScope(),timeboxUnits=this._getTimeboxUnits();return timebox.getPlannedVelocity().then({success:function(plannedVelocity){var percentage=0===plannedVelocity?0:Math.round(100*(estimate/plannedVelocity)),data={estimate:estimate,percentage:percentage,plannedVelocity:plannedVelocity,unit:timeboxUnits};deferred.resolve(data)}}),deferred.promise},_getChartConfig:function(renderData){var percentage=renderData.percentage,percentagePlanned=percentage%100||100,color=Rally.util.Colors.cyan_med,secondaryColor=Rally.util.Colors.grey1;return percentage>100?(color=Rally.util.Colors.blue,secondaryColor=Rally.util.Colors.cyan):percentage>70?color=Rally.util.Colors.cyan:0===percentage&&(color=Rally.util.Colors.grey1),{chartData:{series:[{data:[{name:"Planned Estimate Total",y:percentagePlanned,color:color},{name:"",y:100-percentagePlanned,color:secondaryColor}]}]}}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.TimeboxEnd",{extend:"Rally.apps.iterationtrackingboard.statsbanner.Gauge",alias:"widget.statsbannertimeboxend",requires:["Rally.util.Timebox","Rally.util.Colors"],tpl:['<div class="expanded-widget">','<div class="stat-title">{type} End</div>','<div class="stat-metric">','<div class="metric-chart"></div>','<div class="metric-chart-text">',"{remaining}","</div>",'<div class="metric-subtext">days left of {workdays}</div>',"</div>","</div>",'<div class="collapsed-widget">','<div class="stat-title">{type} End</div>','<div class="stat-metric">{remaining}<span class="stat-metric-secondary"> days</span></div>',"</div>"],config:{data:{type:"Iteration",remaining:0,workdays:0}},onDataChanged:function(){this.getTimeboxData().then({success:this._onDataAssembled,scope:this})},getChartEl:function(){return this.getEl().down(".metric-chart")},_onDataAssembled:function(timeboxData){var renderData=_.merge({type:Ext.String.capitalize(this.getContext().getTimeboxScope().getType())},this.getAcceptanceData(),timeboxData);this.update(renderData),this.refreshChart(this._getChartConfig(renderData))},_getChartConfig:function(renderData){var decimal=renderData.remaining/renderData.workdays,percentLeft=1>decimal?Math.round(100*decimal):0,color=Rally.util.Colors.cyan;return 0===renderData.total?color=Rally.util.Colors.grey1:0===percentLeft?color=renderData.accepted===renderData.total?Rally.util.Colors.lime:Rally.util.Colors.blue:25>=percentLeft&&(color=Rally.util.Colors.blue),{chartData:{series:[{data:[{name:"Days Done",y:100-percentLeft,color:color},{name:"Days Left",y:percentLeft,color:Rally.util.Colors.grey1}]}]}}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.Defects",{extend:"Rally.apps.iterationtrackingboard.statsbanner.BannerWidget",alias:"widget.statsbannerdefects",requires:[],config:{context:null,store:null,data:{activeCount:0}},tpl:['<div class="expanded-widget">','<div class="stat-title">Defects</div>','<div class="stat-metric">','<div class="metric-icon icon-defect"></div>{activeCount}','<div class="stat-secondary">Active</div>',"</div>","</div>",'<div class="collapsed-widget">','<span class="metric-icon icon-defect"></span>','<div class="stat-title">Defects</div>','<div class="stat-metric">{activeCount}</div>',"</div>"],initComponent:function(){this.mon(this.store,"datachanged",this.onDataChanged,this),this.callParent(arguments)},onDataChanged:function(){this.update(this._getRenderData()),this.fireEvent("ready",this)},_getActiveDefectCount:function(){var activeDefects=0;return _.each(this.store.getRange(),function(record){var defectSummary=record.get("Summary")&&record.get("Summary").Defects;defectSummary?_.each(defectSummary.State,function(count,state){"Closed"!==state&&(activeDefects+=count)},this):"defect"===record.self.typePath&&"Closed"!==record.get("State")&&activeDefects++},this),activeDefects},_getRenderData:function(){return{activeCount:this._getActiveDefectCount()}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.Accepted",{extend:"Rally.apps.iterationtrackingboard.statsbanner.Gauge",alias:"widget.statsbanneraccepted",requires:["Rally.util.Colors"],tpl:['<div class="expanded-widget">','<div class="stat-title">Accepted</div>','<div class="stat-metric">','<div class="metric-chart"></div>','<div class="metric-chart-text percent-offset">','{percentage}<div class="metric-percent">%</div>',"</div>",'<div class="metric-subtext">{accepted} of {total} {unit}</div>',"</div>","</div>",'<div class="collapsed-widget">','<div class="stat-title">Accepted</div>','<div class="stat-metric">{percentage}<span class="metric-percent">%</span></div>',"</div>"],config:{data:{percentage:0,accepted:0,total:0,unit:""}},onDataChanged:function(){this.getTimeboxData().then({success:this._onDataAssembled,scope:this})},getChartEl:function(){return this.getEl().down(".metric-chart")},_getTimeboxUnits:function(){return"iteration"===this.getContext().getTimeboxScope().getType()?this.getContext().getWorkspace().WorkspaceConfiguration.IterationEstimateUnitName:this.getContext().getWorkspace().WorkspaceConfiguration.ReleaseEstimateUnitName},_getRenderData:function(timeboxData){var data=_.merge({unit:this._getTimeboxUnits()},this.getAcceptanceData(),timeboxData);return data.accepted=Ext.util.Format.round(data.accepted,2),data.total=Ext.util.Format.round(data.total,2),data.percentage=Math.round(100*(data.accepted/data.total))||0,data},_onDataAssembled:function(timeboxData){var renderData=this._getRenderData(timeboxData);this.update(renderData),this.refreshChart(this._getChartConfig(renderData))},_getChartConfig:function(renderData){var color=Rally.util.Colors.cyan,daysRemaining=renderData.remaining/renderData.workdays,percentage=renderData.percentage;return 100===percentage?color=Rally.util.Colors.lime:0===daysRemaining&&(color=Rally.util.Colors.blue),{chartData:{series:[{data:[{name:"Accepted",y:percentage,color:color},{name:"",y:100-percentage,color:Rally.util.Colors.grey1}]}]}}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.Tasks",{extend:"Rally.apps.iterationtrackingboard.statsbanner.BannerWidget",alias:"widget.statsbannertasks",requires:[],config:{context:null,store:null,data:{count:0}},tpl:['<div class="expanded-widget">','<div class="stat-title">Tasks</div>','<div class="stat-metric">','<span class="metric-icon icon-task"></span>{count}','<div class="stat-secondary">Active</div>',"</div>","</div>",'<div class="collapsed-widget">','<span class="metric-icon icon-task"></span>','<div class="stat-title">Tasks</div>','<div class="stat-metric">{count}</div>',"</div>"],initComponent:function(){this.mon(this.store,"datachanged",this.onDataChanged,this),this.callParent(arguments)},onDataChanged:function(){this.update(this._getRenderData()),this.fireEvent("ready",this)},_getRenderData:function(){return{count:this._getTaskCount()}},_getTaskCount:function(){var taskCount=0;return _.each(this.store.getRange(),function(record){var taskSummary=record.get("Summary")&&record.get("Summary").Tasks;taskSummary&&_.each(taskSummary["state+blocked"],function(count,state){Ext.String.startsWith(state,"Completed")||(taskCount+=count)},this)},this),taskCount}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.IterationProgressMixin",{requires:["Rally.ui.chart.Chart"],_configureYAxis:function(ticks,axis){for(var intervalY=(this.chartComponentConfig.chartConfig.yAxis[axis].max-0)/(ticks-1),ticksY=[],i=0;ticks>i;i++)ticksY.push(i*intervalY);this.chartComponentConfig.chartConfig.yAxis[axis].tickPositions=ticksY},_configureYAxisIntervals:function(){var ticks=5;this._configureYAxis(ticks,0),"burndown"===this.chartType&&this._configureYAxis(ticks,1)},_getElementValue:function(element){return void 0!==element.textContent?element.textContent:element.text},_getStringValues:function(elements){var i,strings=[];for(i=0;elements.length>i;i++)strings.push(this._getElementValue(elements[i]));return strings},_getNumberValues:function(elements){var i,numbers=[];for(i=0;elements.length>i;i++)this._getElementValue(elements[i])?numbers.push(1*this._getElementValue(elements[i]).split(" ")[0]):numbers.push(0);return numbers},_computeMaxYAxisValue:function(series){var i,j,max=0;for(i=0;series[0].data.length>i;i++){var val=0;for(j=0;series.length>j;j++)series[j].data.length===series[0].data.length&&(val+=series[j].data[i]);val>max&&(max=val)}return max=4*Math.ceil(max/4),0===max?4:max},_createChartDatafromXML:function(xml){var parseXml;if(window.DOMParser!==void 0)parseXml=function(xmlStr){return(new window.DOMParser).parseFromString(xmlStr,"text/xml")};else{if(void 0===window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw Error("No XML parser found");parseXml=function(xmlStr){var xmlDoc=new window.ActiveXObject("Microsoft.XMLDOM");return xmlDoc.async="false",xmlDoc.loadXML(xmlStr),xmlDoc}}return parseXml(xml)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.IterationProgressChart",{requires:["Rally.ui.chart.Chart"],chartComponentConfig:{xtype:"rallychart",suppressClientMetrics:!0}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.BurndownChart",{alias:"widget.statsbannerburndownchart",extend:"Ext.Container",requires:["Rally.ui.chart.Chart"],mixins:["Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.IterationProgressMixin","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.IterationProgressChart"],currentScope:void 0,context:void 0,height:void 0,width:void 0,displayTitle:"Burndown",minimalMode:!1,onChartDataLoaded:Ext.emptyFn,initComponent:function(){this.callParent(arguments),Ext.Ajax.request({url:"/slm/charts/itsc.sp",params:{iterationOid:this.context.getTimeboxScope().getRecord().getId(),cpoid:this.context.getProject().ObjectID},method:"GET",withCredentials:!0,success:function(response,request){this._loadData(response.responseText)},requester:this,scope:this})},_loadData:function(chartData){var xmlDoc=this._createChartDatafromXML(chartData);this._createBurndownChartDatafromXML(xmlDoc)},_createChartConfig:function(overrides){var clickChartHandler=_.isFunction(this.clickHandler)?this.clickHandler:Ext.emptyFn;return Ext.Object.merge({xtype:"rallychart",chartColors:["#005eb8","#666666","#8dc63f"],updateAfterRender:Ext.bind(this._onLoad,this),chartConfig:{chart:{height:this.height,width:this.width,spacingTop:2,spacingRight:0,spacingBottom:8,spacingLeft:0,zoomType:"xy",alignTicks:!1,animation:!0,events:{click:clickChartHandler}},plotOptions:{series:{animation:!0,shadow:!1,borderWidth:0,marker:{enabled:!1,states:{hover:{enabled:!1}}},events:{click:clickChartHandler}},column:{point:{events:{click:clickChartHandler}}}},legend:{enabled:!0},title:{text:null},xAxis:{tickmarkPlacement:"on",tickInterval:1},yAxis:[{title:{text:null},min:0,labels:{style:{color:"#005eb8"}}},{title:{text:null},min:0,opposite:!0,labels:{style:{color:"#8dc63f"}}}]},chartData:{categories:[],series:[{name:"To Do",type:"column",data:[],tooltip:{enabled:!1}},{name:"Ideal",type:"line",dashStyle:"Solid",data:[],marker:{enabled:!0,radius:3},tooltip:{enabled:!1}},{name:"Accepted",type:"column",data:[],yAxis:1,tooltip:{enabled:!1}}]}},overrides||{})},_createMinimalConfig:function(){var config=this._createChartConfig();return delete config.chartConfig.xAxis,delete config.chartConfig.yAxis,delete config.chartData.series[1].marker,config=Ext.Object.merge(config,{chartConfig:{chart:{zoomType:""},tooltip:{formatter:function(){return!1}},legend:{enabled:!1},xAxis:{labels:{enabled:!1},tickPositions:[]},yAxis:[{title:{text:null},min:0,labels:{enabled:!1}},{title:{text:null},min:0,opposite:!0,labels:{enabled:!1}}],title:{text:null}}})},_createBurndownChartDatafromXML:function(xmlDoc){this.chartComponentConfig=this.minimalMode?this._createMinimalConfig():this._createChartConfig();var xmlChartData=xmlDoc.getElementsByTagName("chart_data")[0],xmlChartValueText=xmlDoc.getElementsByTagName("chart_value_text")[0],draw=xmlDoc.getElementsByTagName("draw")[0],axis_value=xmlDoc.getElementsByTagName("axis_value")[1],rows=xmlChartData.getElementsByTagName("row");this.chartComponentConfig.chartData.categories=this._getStringValues(rows[0].getElementsByTagName("string")),this.chartComponentConfig.chartData.series[0].data=this._getNumberValues(rows[1].getElementsByTagName("number")),this.chartComponentConfig.chartData.series[1].data=this._getNumberValues(rows[3].getElementsByTagName("number")),this.chartComponentConfig.chartData.series[2].data=this._getNumberValues(xmlChartValueText.getElementsByTagName("row")[2].getElementsByTagName("number")),this.chartComponentConfig.chartConfig.yAxis[0].max=1*axis_value.getAttribute("max");var texts=draw.getElementsByTagName("text");for(i=0;texts.length>i;i++)"vertical_down"===texts[i].getAttribute("orientation")&&(this.chartComponentConfig.chartConfig.yAxis[1].max=1*this._getElementValue(texts[i]));this._configureYAxisIntervals(),this.chartComponentConfig.chartConfig.xAxis.tickInterval=Math.floor(this.chartComponentConfig.chartData.series[0].data.length/4),this.add(this.chartComponentConfig)},_onLoad:function(){this.fireEvent("contentupdated",this),this.fireEvent("ready",this),Rally.BrowserTest&&Rally.BrowserTest.publishComponentReady(this)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.CumulativeFlowChart",{alias:"widget.statsbannercumulativeflowchart",extend:"Ext.Container",requires:["Rally.ui.chart.Chart"],mixins:["Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.IterationProgressMixin","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.IterationProgressChart"],cls:"rally-iteration-progress-cumulative-flow-chart",currentScope:void 0,context:void 0,height:void 0,width:void 0,displayTitle:"Cumulative Flow",minimalMode:!1,initComponent:function(){this.callParent(arguments),Ext.Ajax.request({url:"/slm/charts/icfc.sp",params:{iterationOid:this.context.getTimeboxScope().getRecord().getId(),cpoid:this.context.getProject().ObjectID,bigChart:!0},method:"GET",withCredentials:!0,success:function(response,request){this._loadData(response.responseText)},requester:this,scope:this})},_loadData:function(chartData){var xmlDoc=this._createChartDatafromXML(chartData);this._createCumulativeFlowChartDatafromXML(xmlDoc)},_createMinimalConfig:function(){var config=this._createChartConfig();return delete config.chartConfig.xAxis,delete config.chartConfig.yAxis,Ext.Object.merge(config,{chartConfig:{tooltip:{formatter:function(){return!1}},legend:{enabled:!1},xAxis:{labels:{enabled:!1},tickPositions:[]},yAxis:[{title:{text:null},min:0,labels:{enabled:!1}}],title:{text:null}}})},_createChartConfig:function(overrides){var clickChartHandler=_.isFunction(this.clickHandler)?this.clickHandler:Ext.emptyFn;return Ext.Object.merge({xtype:"rallychart",updateAfterRender:Ext.bind(this._onLoad,this),chartColors:["#C0C0C0","#FF8200","#F6A900","#FAD200","#CADDA3","#1E7C00"],chartConfig:{chart:{height:this.height,width:this.width,spacingTop:2,spacingRight:0,spacingBottom:8,spacingLeft:0,alignTicks:!1,animation:!0,type:"area",events:{click:clickChartHandler}},plotOptions:{series:{animation:!0,marker:{enabled:!1,states:{hover:{enabled:!1}}}},area:{point:{events:{click:clickChartHandler}},stacking:"normal"}},legend:{enabled:!0},title:{text:null},xAxis:{tickmarkPlacement:"on",tickInterval:1},yAxis:[{title:{text:null},min:0,labels:{style:{color:"#005eb8"}}}]},chartData:{categories:[],series:[]}},overrides||{})},_createCumulativeFlowChartDatafromXML:function(xmlDoc){this.chartComponentConfig=this.minimalMode?this._createMinimalConfig():this._createChartConfig();var xmlChartData=xmlDoc.getElementsByTagName("chart_data")[0],rows=xmlChartData.getElementsByTagName("row"),i,j;for(this.chartComponentConfig.chartData.categories=this._getStringValues(rows[0].getElementsByTagName("string")),j=rows.length-1,i=0;j>0;j--,i++)this.chartComponentConfig.chartData.series[i]={},this.chartComponentConfig.chartData.series[i].data=this._getNumberValues(rows[j].getElementsByTagName("number")),this.chartComponentConfig.chartData.series[i].name=this._getStringValues(rows[j].getElementsByTagName("string"))[0];this.chartComponentConfig.chartConfig.yAxis[0].max=this._computeMaxYAxisValue(this.chartComponentConfig.chartData.series),this._configureYAxisIntervals(),6===this.chartComponentConfig.chartData.series.length?this.chartComponentConfig.chartConfig.legend.itemStyle={fontSize:"8px"}:5===this.chartComponentConfig.chartData.series.length&&(this.chartComponentConfig.chartConfig.legend.itemStyle={fontSize:"10px"}),this.chartComponentConfig.chartConfig.xAxis.tickInterval=Math.floor(this.chartComponentConfig.chartData.series[0].data.length/4),this.add(this.chartComponentConfig)},_onLoad:function(){this.fireEvent("contentupdated",this),this.fireEvent("ready",this),Rally.BrowserTest&&Rally.BrowserTest.publishComponentReady(this)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.PieChart",{alias:"widget.statsbannerpiechart",extend:"Ext.Container",requires:["Rally.ui.chart.Chart"],mixins:{recordable:"Rally.clientmetrics.ClientMetricsRecordable"},currentScope:void 0,height:void 0,width:void 0,displayTitle:"Pie",config:{context:null},initComponent:function(){this.callParent(arguments),void 0===this._storyStates?Rally.data.ModelFactory.getModels({types:["UserStory","Defect","DefectSuite","TestSet"],context:this.getContext(),scope:this,requester:this,success:this._createStateMap}):this._loadArtifacts()},_createStateMap:function(models){var stateMap=["Defined","In-Progress","Completed"],stateMapIndex=0,storyStates={};_.each(models.UserStory.getField("ScheduleState").getAllowedStringValues(),function(state){state===stateMap[stateMapIndex+1]&&stateMapIndex++,storyStates[state]=stateMap[stateMapIndex]}),this._storyStates=storyStates,this._loadArtifacts()},_loadArtifacts:function(){this._chartData=[],this._childChartData=[],this.store=Ext.create("Rally.data.wsapi.artifact.Store",{models:["User Story","Defect","Defect Suite","Test Set"],fetch:["Defects","PlanEstimate","Requirement","FormattedID","Name","Blocked","BlockedReason","ScheduleState","State","Tasks","TestCases"],filters:[this.context.getTimeboxScope().getQueryFilter()],sorters:[{property:"ScheduleState"}],context:this.context.getDataContext(),limit:1/0,requester:this,autoLoad:!0,listeners:{load:this._loadChildCollections,scope:this}})},_loadChildCollections:function(){var records=this.store.getRange(),promises=[];_.each(records,function(record){record.get("Defects")&&record.get("Defects").Count&&promises.push(record.getCollection("Defects",{fetch:["FormattedID","Name","ScheduleState","Blocked","BlockedReason","Requirement","State"]}).load({requester:this,callback:function(defects){record.get("Defects").Results=defects}})),record.get("Tasks")&&record.get("Tasks").Count&&promises.push(record.getCollection("Tasks",{fetch:["FormattedID","Name","Blocked","BlockedReason","WorkProduct","State"]}).load({requester:this,callback:function(tasks){record.get("Tasks").Results=tasks}})),record.get("TestCases")&&record.get("TestCases").Count&&promises.push(record.getCollection("TestCases",{fetch:["FormattedID","Name","Type","WorkProduct"]}).load({requester:this,callback:function(testCases){record.get("TestCases").Results=testCases}}))}),promises.length>0?Deft.Promise.all(promises).then({success:this._onAllDataLoaded,scope:this}):this._onAllDataLoaded()},_onAllDataLoaded:function(){_.each(this.store.getRange(),function(record){var defects=record.get("Defects"),defectCount=defects&&defects.Count||0,tasks=record.get("Tasks"),taskCount=tasks&&tasks.Count||0,testCases=record.get("TestCases"),testCaseCount=testCases&&testCases.Count||0,relatedCount=taskCount+defectCount+testCaseCount,planEstimate=record.get("PlanEstimate")||1,pointSizeForChildren=planEstimate/relatedCount||1,nullPointString="No tasks or defects.";this._addPointForTopLevelItem(record,relatedCount),0===relatedCount?this._childChartData.push({name:nullPointString,y:planEstimate,color:"#FFF",rallyName:null,status:"",blocked:!1,blockedReason:"",hasChildren:!1,relatedCount:0,ref:null,parentFormattedID:null}):(defects&&defects.Results&&_.each(defects.Results,function(defect){this._addPointForChildItem(defect,record.get("FormattedID"),pointSizeForChildren)},this),tasks&&tasks.Results&&_.each(tasks.Results,function(task){this._addPointForChildItem(task,record.get("FormattedID"),pointSizeForChildren)},this),testCases&&testCases.Results&&_.each(testCases.Results,function(testCase){this._addPointForChildItem(testCase,record.get("FormattedID"),pointSizeForChildren,record.get("ScheduleState"),record.get("Blocked"))},this))},this);var chart=this._createChartConfig();this.add(chart),this.recordLoadEnd()},_onLoad:function(){this.fireEvent("contentupdated",this),this.fireEvent("ready",this),Rally.BrowserTest&&Rally.BrowserTest.publishComponentReady(this)},_createChartConfig:function(overrides){var clickChartHandler=_.isFunction(this.clickHandler)?this.clickHandler:Ext.emptyFn,height=this.height,pieHeight=.9*this.height;return Ext.Object.merge({xtype:"rallychart",loadMask:!1,updateAfterRender:Ext.bind(this._onLoad,this),chartData:{series:[{type:"pie",name:"Parents",data:this._chartData,size:pieHeight,allowPointSelect:!1,dataLabels:{enabled:!1}},{type:"pie",name:"Children",data:this._childChartData,size:pieHeight,innerSize:.8*pieHeight,allowPointSelect:!1,dataLabels:{enabled:!1}}]},chartConfig:{chart:{type:"pie",height:height,width:this.width,spacingTop:0,spacingRight:3,spacingBottom:0,spacingLeft:3,events:{click:clickChartHandler}},subtitle:{useHTML:!0,text:'<table align="center" class="pie-chart-legend"><tr><td><span class="legend-swatch defined-sample-swatch"></span><span>Defined</td><td><span class="legend-swatch in-progress-sample-swatch"></span>In-Progress</td><td><span class="legend-swatch completed-sample-swatch"></span>Completed</td><td><span class="legend-swatch blocked-sample-swatch"></span>Blocked</td></tr></table>',verticalAlign:"bottom",floating:!0,x:-10,y:-20},tooltip:{formatter:this._formatTooltip,useHTML:!0},spacingTop:0,title:{text:null},plotOptions:{pie:{cursor:"pointer",shadow:!1,center:["50%","45%"],point:{events:{click:function(event){this.ref&&Rally.nav.Manager.showDetail(this.ref)}}},showInLegend:!1}}}},overrides||{})},_addPointForTopLevelItem:function(record,relatedCount){var blocked=record.get("Blocked"),color=this._colorFromStatus(this._storyStates[record.get("ScheduleState")],blocked),pointSize=record.get("PlanEstimate")||1;this._chartData.push({name:record.get("FormattedID"),y:pointSize,color:color,rallyName:record.get("Name"),status:record.get("ScheduleState"),blocked:blocked,blockedReason:blocked?record.get("BlockedReason"):null,hasChildren:relatedCount>0,relatedCount:relatedCount,ref:record.get("_ref"),parentFormattedID:null})},_colorFromStatus:function(state,blocked){var progressColors={Defined:"#C0C0C0","In-Progress":"#00A9E0",Completed:"#8DC63F",Blocked:"#EE1C25"},color=progressColors[state];return blocked&&(color=progressColors.Blocked),color},_addPointForChildItem:function(record,parentFormattedID,pointSize,parentState,isParentBlocked){var blocked=record.get("Blocked"),state=record.get("ScheduleState")||record.get("State")||record.get("Type"),color=this._colorFromStatus(this._storyStates[parentState||state],blocked||isParentBlocked);this._childChartData.push({name:record.get("FormattedID"),y:pointSize,color:color,rallyName:record.get("Name"),status:state,blocked:blocked,blockedReason:blocked?record.get("BlockedReason"):null,hasChildren:!1,relatedCount:0,ref:record.get("_ref"),parentFormattedID:parentFormattedID})},_formatTooltip:function(){var relatedMessage="",blockedMessage="",artifactName=this.point.rallyName?"<b>"+this.point.name+"</b>: "+this.point.rallyName+"<br/>":this.point.name;return this.point.blocked&&(blockedMessage="<br/><b>Blocked</b>",this.point.blockedReason&&(blockedMessage+=": "+this.point.blockedReason)),this.point.series&&"Parents"===this.point.series.name&&(relatedMessage=this.point.relatedCount?"<br/>Related Items: "+this.point.relatedCount:""),'<div style="min-width:200px;white-space:normal">'+artifactName+this.point.status+relatedMessage+blockedMessage+"</div>"}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.MinimalPieChart",{alias:"widget.statsbannerminimalpiechart",extend:"Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.PieChart",_loadArtifacts:function(){this._chartData=[],this._childChartData=[],this._createDataPointsFromSummary()},_createDataPointsFromSummary:function(){_.each(this.store.getRange(),function(record){var summary=record.get("Summary"),totalChildItems=0,planEstimate=record.get("PlanEstimate")||1,nullPointString="No tasks or defects.",testCases=record.get("TestCases"),keys,state,scheduleState,blocked,count;totalChildItems+=summary.Defects?summary.Defects.Count:0,totalChildItems+=summary.Tasks?summary.Tasks.Count:0,totalChildItems+=testCases?testCases.Count:0;var pointSizeForChildren=planEstimate/totalChildItems||1;this._addPointForTopLevelItem(record,totalChildItems),0===totalChildItems&&this._childChartData.push({name:nullPointString,y:planEstimate,color:"#FFF",rallyName:null,status:"",blocked:!1,blockedReason:"",hasChildren:!1,relatedCount:0,ref:null,parentFormattedID:null}),summary.Tasks&&summary.Tasks.Count&&(keys=_.keys(summary.Tasks["state+blocked"]),_.each(keys,function(key){state=key.split("+"),scheduleState=state[0],blocked="true"===state[1],count=summary.Tasks["state+blocked"][key],_.each(_.range(0,count),function(point){this._addPointForChildItem(record.get("FormattedID"),pointSizeForChildren,scheduleState,blocked)},this)},this)),summary.Defects&&summary.Defects.Count&&(keys=_.keys(summary.Defects["schedulestate+blocked"]),_.each(keys,function(key){state=key.split("+"),scheduleState=state[0],blocked="true"===state[1],count=summary.Defects["schedulestate+blocked"][key],_.each(_.range(0,count),function(point){this._addPointForChildItem(record.get("FormattedID"),pointSizeForChildren,scheduleState,blocked)},this)},this)),testCases&&testCases.Count&&_.each(_.range(0,testCases.Count),function(point){this._addPointForChildItem(record.get("FormattedID"),pointSizeForChildren,record.get("ScheduleState"),record.get("Blocked"))},this)},this);var chart=this._createChartConfig();this.add(chart)},_onAllDataLoaded:function(){_.each(this.store.getRange(),function(record){var defects=record.get("Defects"),defectCount=defects&&defects.Count||0,tasks=record.get("Tasks"),taskCount=tasks&&tasks.Count||0,testCases=record.get("TestCases"),testCaseCount=testCases&&testCases.Count||0,relatedCount=taskCount+defectCount+testCaseCount,planEstimate=record.get("PlanEstimate")||1,pointSizeForChildren=planEstimate/relatedCount||1,nullPointString="No tasks or defects.";this._addPointForTopLevelItem(record,relatedCount),0===relatedCount?this._childChartData.push({name:nullPointString,y:planEstimate,color:"#FFF",rallyName:null,status:"",blocked:!1,blockedReason:"",hasChildren:!1,relatedCount:0,ref:null,parentFormattedID:null}):(defects&&defects.Results&&_.each(defects.Results,function(defect){this._addPointForChildItem(defect,record.get("FormattedID"),pointSizeForChildren)},this),tasks&&tasks.Results&&_.each(tasks.Results,function(task){this._addPointForChildItem(task,record.get("FormattedID"),pointSizeForChildren)},this),testCases&&testCases.Results&&_.each(testCases.Results,function(testCase){this._addPointForChildItem(testCase,record.get("FormattedID"),pointSizeForChildren,record.get("ScheduleState"),record.get("Blocked"))},this))},this);var chart=this._createChartConfig();this.add(chart),this.recordLoadEnd()},_createChartConfig:function(overrides){var clickChartHandler=_.isFunction(this.clickHandler)?this.clickHandler:Ext.emptyFn,height=this.height;return Ext.Object.merge({xtype:"rallychart",loadMask:!1,updateAfterRender:Ext.bind(this._onLoad,this),chartData:{series:[{type:"pie",name:"Parents",data:this._chartData,size:height,allowPointSelect:!1,dataLabels:{enabled:!1}},{type:"pie",name:"Children",data:this._childChartData,size:height,innerSize:.8*height,allowPointSelect:!1,dataLabels:{enabled:!1}}]},chartConfig:{chart:{type:"pie",height:height,width:this.width,spacingTop:0,spacingRight:0,spacingBottom:0,spacingLeft:0,events:{click:clickChartHandler}},tooltip:{formatter:function(){return!1}},spacingTop:0,title:{text:null},plotOptions:{pie:{shadow:!1,center:["50%","50%"],point:{events:{click:clickChartHandler}},showInLegend:!1}}}},overrides||{})},_addPointForTopLevelItem:function(record,relatedCount){var blocked=record.get("Blocked"),color=this._colorFromStatus(this._storyStates[record.get("ScheduleState")],blocked),pointSize=record.get("PlanEstimate")||1;this._chartData.push({name:record.get("FormattedID"),y:pointSize,color:color,rallyName:record.get("Name"),status:record.get("ScheduleState"),blocked:blocked,blockedReason:blocked?record.get("BlockedReason"):null,hasChildren:relatedCount>0,relatedCount:relatedCount,ref:record.get("_ref"),parentFormattedID:null})},_addPointForChildItem:function(parentFormattedID,pointSize,state,blocked){var color=this._colorFromStatus(this._storyStates[state],blocked);this._childChartData.push({y:pointSize,color:color,status:state,blocked:blocked,hasChildren:!1,relatedCount:0,parentFormattedID:parentFormattedID})}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.IterationProgressDialogChartToggle",{requires:["Rally.ui.Button"],extend:"Ext.Container",alias:"widget.iterationprogressdialogcharttoggle",componentCls:"iteration-progress-toggle-button-group",layout:"hbox",border:1,width:106,activeButtonCls:"rly-active",defaultType:"rallybutton",config:{startingIndex:0},items:[{cls:"toggle rly-left pie-chart",iconCls:"icon-pie",frame:!1,toggleGroup:"iterationprogressviewtoggle",style:{fontSize:"15px"},toolTipConfig:{html:"Pie",anchor:"top",hideDelay:0},userAction:"IterationProgressApp - User clicked pie chart"},{cls:"toggle center burndown",iconCls:"icon-bars",frame:!1,toggleGroup:"iterationprogressviewtoggle",toolTipConfig:{html:"Burndown",anchor:"top",hideDelay:0},userAction:"IterationProgressApp - User clicked burndown"},{cls:"toggle rly-right cumulativeflow",iconCls:"icon-graph",frame:!1,toggleGroup:"iterationprogressviewtoggle",toolTipConfig:{html:"Cumulative Flow",anchor:"top",hideDelay:0},userAction:"IterationProgressApp - User clicked CFD"}],initComponent:function(config){this.initConfig(config),this.callParent(arguments),this.addEvents(["toggle"]),this.items.each(function(item){item.on("click",this._onButtonClick,this)},this),this.setCurrentItem(this.startingIndex)},_onButtonClick:function(btn){var btnIndex=this.items.indexOf(btn);btnIndex!==this._activeIndex&&(this._setActive(btn),this.fireEvent("toggle",this,btnIndex))},_setActive:function(btn){this.items.each(function(item,btnIndex){item===btn?item.hasCls(this.activeButtonCls.split(" ")[0])||(item.addCls(this.activeButtonCls),this._activeIndex=btnIndex):item.removeCls(this.activeButtonCls)},this)},setCurrentItem:function(itemIndex){this._setActive(this.items.get(itemIndex))}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.IterationProgressDialog",{extend:"Rally.ui.dialog.Dialog",alias:"widget.statsbanneriterationprogressdialog",requires:["Rally.apps.iterationtrackingboard.statsbanner.IterationProgressDialogChartToggle","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.BurndownChart","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.CumulativeFlowChart","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.PieChart","Rally.ui.carousel.Carousel"],config:{startingIndex:0,autoShow:!0,draggable:!0,disableScroll:!0,width:820,height:650,closable:!0,constrain:!0,store:null,context:null},layout:{type:"vbox",align:"center"},cls:"iteration-progress-dialog",constructor:function(config){this.initConfig(config||{}),this.callParent(arguments)},initComponent:function(){var chartWidth=704,chartHeight=570;this.callParent(arguments),this.toggle=this.add({xtype:"iterationprogressdialogcharttoggle",startingIndex:this.startingIndex,listeners:{toggle:this._toggleButtonClick,scope:this}}),this.carousel=this.add({xtype:"rallycarousel",showDots:!1,enableAnimations:!1,carouselItems:[{xtype:"statsbannerpiechart",width:chartWidth,height:chartHeight,context:this.context},{xtype:"statsbannerburndownchart",width:chartWidth,height:chartHeight,context:this.context,store:this.store},{xtype:"statsbannercumulativeflowchart",width:chartWidth,height:chartHeight,context:this.context,store:this.store}],startingIndex:this.startingIndex,listeners:{carouselmove:{fn:this._onCarouselMove,scope:this},afterlayout:{fn:this._afterLayout,single:!0,scope:this}}})},_toggleButtonClick:function(toggleBtnContainer,buttonIndex){this._setChart(buttonIndex)},_afterLayout:function(){Ext.defer(this._setChart,10,this,[this.startingIndex])},_setChart:function(chartIndex){this.carousel.setCurrentItem(chartIndex),this.toggle.setCurrentItem(chartIndex),this.header.titleCmp.textEl.update(this.carousel.getCurrentItem().displayTitle)},_onCarouselMove:function(carousel){this._setChart(carousel.getCurrentItemIndex())}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.IterationProgress",{extend:"Rally.apps.iterationtrackingboard.statsbanner.BannerWidget",alias:"widget.statsbanneriterationprogress",requires:["Rally.ui.carousel.Carousel","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.BurndownChart","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.CumulativeFlowChart","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.MinimalPieChart","Rally.apps.iterationtrackingboard.statsbanner.iterationprogresscharts.PieChart","Rally.apps.iterationtrackingboard.statsbanner.IterationProgressDialog","Ext.state.Manager"],config:{context:null,store:null},currentChartDisplayed:1,stateId:"stats-banner-iteration-progress",stateful:!0,clientMetrics:{method:"_onChartClick",description:"opened IterationProgressDialog"},tpl:['<div class="expanded-widget">','<div class="stat-title"></div>','<div class="stat-metric">','<div class="stat-carousel"></div>',"</div>","</div>",'<div class="collapsed-widget">','<span class="metric-icon icon-pie"></span>','<div class="stat-title"></div>',"</div>"],initComponent:function(){this.mon(this.store,"datachanged",this.onDataChanged,this),this.callParent(arguments);var boundClickHandler=Ext.bind(this._onChartClick,this);this.stateId=this.context.getScopedStateId(this.stateId),this.carouselItems=[{xtype:"statsbannerminimalpiechart",width:150,height:60,minimalMode:!0,clickHandler:boundClickHandler,context:this.context,store:this.store},{xtype:"statsbannerburndownchart",width:150,height:63,minimalMode:!0,clickHandler:boundClickHandler,context:this.context,store:this.store},{xtype:"statsbannercumulativeflowchart",width:150,height:63,minimalMode:!0,clickHandler:boundClickHandler,context:this.context,store:this.store}],_.each(this.carouselItems,function(carouselItem){carouselItem.listeners={ready:this._onChartReady,scope:this}},this),this._pendingChartReadies=this.carouselItems.length,this.expanded?this.onDataChanged():this.fireEvent("ready",this)},expand:function(){this.callParent(),this.carousel&&0!==this.carousel.getWidth()||this.onDataChanged()},_onChartReady:function(){this._pendingChartReadies-=1,0===this._pendingChartReadies&&this.fireEvent("ready",this)},_onChartClick:function(){var currentIndex=this.carousel.getCurrentItemIndex();Ext.create("Rally.apps.iterationtrackingboard.statsbanner.IterationProgressDialog",{startingIndex:currentIndex,store:this.store,context:this.context})},_cleanupCarousel:function(){this.carousel&&(this.carousel.destroy(),delete this.carousel)},onDestroy:function(){this._cleanupCarousel(),this.callParent(arguments)},onRender:function(){this.callParent(arguments),this.getContext().getTimeboxScope().getRecord()||this._addPlaceholder()},applyState:function(state){state&&(this.currentChartDisplayed=state.currentChartDisplayed>this.carouselItems.length-1||0>state.currentChartDisplayed?1:state.currentChartDisplayed)},getState:function(){return{currentChartDisplayed:this.currentChartDisplayed}},onDataChanged:function(){this._cleanupCarousel();var addCarousel=_.bind(function(){this.getContext().getTimeboxScope().getRecord()?(this.update(),this.createCarousel()):this._addPlaceholder()},this);this.expanded&&(this.rendered?addCarousel():this.on("afterrender",addCarousel))},createCarousel:function(){this.carousel=Ext.create("Rally.ui.carousel.Carousel",{showHeader:!1,showDots:!0,smallDots:!0,renderTo:this.getEl().down(".stat-carousel"),height:75,layout:{type:"vbox",align:"center"},listeners:{currentitemset:this._updateTitle,carouselmove:this._updateTitle,scope:this},carouselItems:this.carouselItems}),Ext.isIE8m||this.carousel.setCurrentItem(this.currentChartDisplayed),this.carousel.on("carouselmove",this._chartShownChanged,this)},_updateTitle:function(carousel){_.each(this.getEl().query(".stat-title"),function(el){Ext.fly(el).update(carousel.getCurrentItem().displayTitle)},this)},_chartShownChanged:function(){var chartShown=_.findIndex(this.carouselItems,{xtype:this.carousel.getCurrentItem().xtype});this.currentChartDisplayed=chartShown||0,this.saveState()},_addPlaceholder:function(){this.update(),this.expanded&&(this.carousel=Ext.create("Ext.Container",{renderTo:this.getEl().down(".stat-carousel"),html:"no iteration data"}))}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.statsbanner.CollapseExpand",{extend:"Rally.apps.iterationtrackingboard.statsbanner.BannerWidget",alias:"widget.statsbannercollapseexpand",requires:[],mixins:["Rally.clientmetrics.ClientMetricsRecordable"],tpl:['<div class="expanded-widget">','<div class="toggle-icon icon-collapse-row"></div>',"</div>",'<div class="collapsed-widget">','<div class="toggle-icon icon-expand-row"></div>',"</div>"],componentCls:"collapse-expand",bubbleEvents:["collapse","expand"],afterRender:function(){this.callParent(arguments),this.parentComponent.getEl().on("click",this._onCollapseExpandClick,this),this.fireEvent("ready",this)},_onCollapseExpandClick:function(event,target){this.expanded?(target.getAttribute("class").indexOf("toggle-icon")>-1||Ext.get(target).down("div .toggle-icon"))&&this.fireEvent("collapse",this):this.fireEvent("expand",this)},expand:function(){this.recordAction({description:"Expand statsbanner"}),this.callParent(arguments),this.doComponentLayout()},collapse:function(){this.recordAction({description:"Collapse statsbanner"}),this.callParent(arguments),this.doComponentLayout()}})})();
                var bannerme;(function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.iterationtrackingboard.StatsBanner",{extend:"Ext.Container",alias:"widget.statsbanner",requires:["Rally.Message","Rally.apps.iterationtrackingboard.statsbanner.PlannedVelocity","Rally.apps.iterationtrackingboard.statsbanner.TimeboxEnd","Rally.apps.iterationtrackingboard.statsbanner.Defects","Rally.apps.iterationtrackingboard.statsbanner.Accepted","Rally.apps.iterationtrackingboard.statsbanner.Tasks","Rally.apps.iterationtrackingboard.statsbanner.IterationProgress","Rally.apps.iterationtrackingboard.statsbanner.CollapseExpand"],mixins:["Rally.Messageable","Rally.clientmetrics.ClientMetricsRecordable"],cls:"stats-banner",layout:"hbox",border:0,width:"100%",stateful:!0,stateEvents:["expand","collapse"],config:{context:null,expanded:!1,optimizeLayouts:!1},items:[{xtype:"statsbannerplannedvelocity"},{xtype:"statsbannertimeboxend"},{xtype:"statsbanneraccepted"},{xtype:"statsbannerdefects"},{xtype:"statsbannertasks"},{xtype:"statsbanneriterationprogress",flex:2},{xtype:"statsbannercollapseexpand",flex:0}],constructor:function(config){config.optimizeLayouts&&(config._isLayoutRoot=!0),this.callParent(arguments)},initComponent:function(){this.recordLoadBegin({description:"initializing"}),this.addEvents("expand","collapse"),this._readyCount=0,this.stateId=this.context.getScopedStateId("stats-banner"),this.subscribe(this,Rally.Message.objectDestroy,this._update,this),this.subscribe(this,Rally.Message.objectCreate,this._update,this),this.subscribe(this,Rally.Message.objectUpdate,this._update,this),this.subscribe(this,Rally.Message.bulkUpdate,this._update,this),this.subscribe(this,Rally.Message.bulkImport,this._update,this),bannerme=this,console.log("this.context : ",this.context),console.log("this.context.getTimeboxScope() : ",this.context.getTimeboxScope()),console.log("QueryFilter : ",this.context.getTimeboxScope().getQueryFilter()),console.log("QueryFilter BannerMe: ",bannerme.context.getTimeboxScope().getQueryFilter()),this.store=Ext.create("Rally.data.wsapi.artifact.Store",{models:["User Story","Defect","Defect Suite","Test Set"],fetch:["Defects:summary[State;ScheduleState+Blocked]","PlanEstimate","Requirement","FormattedID","Name","Blocked","BlockedReason","ScheduleState","State","Tasks:summary[State+Blocked]","TestCases"],useShallowFetch:!0,sorters:[{property:"ScheduleState"}],filters:[this.context.getTimeboxScope().getQueryFilter()],context:this.context.getDataContext(),limit:1/0,requester:this}),this.items=this._configureItems(this.items),this.on("expand",this._onExpand,this),this.on("collapse",this._onCollapse,this),this.callParent(arguments),this._update()},onRender:function(){this.expanded?this.removeCls("collapsed"):this.addCls("collapsed"),this._setExpandedOnChildItems(),this.callParent(arguments)},applyState:function(state){Ext.isDefined(state.expanded)&&this.setExpanded(state.expanded),this._setExpandedOnChildItems()},getState:function(){return{expanded:this.expanded}},_setExpandedOnChildItems:function(){_.each(this.items.getRange(),function(item){item.setExpanded(this.expanded)},this)},_getItemDefaults:function(){return{flex:1,context:this.context,store:this.store,expanded:this.expanded,parentComponent:this,listeners:{ready:this._onReady,scope:this}}},_onReady:function(){this._readyCount=this._readyCount+1,this._readyCount===this.items.getCount()&&(this.recordComponentReady(),this._readyCount=0,this._recordLoadEnd())},_onCollapse:function(){this.addCls("collapsed"),this.setExpanded(!1),_.invoke(this.items.getRange(),"collapse")},_onExpand:function(){this.removeCls("collapsed"),this.setExpanded(!0),_.invoke(this.items.getRange(),"expand")},_hasTimebox:function(){return!!this.context.getTimeboxScope().getRecord()},_configureItems:function(items){var defaults=this._getItemDefaults();return _.map(items,function(item){return _.defaults(_.cloneDeep(item),defaults)})},_recordLoadEnd:function(){this.recordLoadEnd()},_update:function(){this._hasTimebox()?this.store.load():this._recordLoadEnd()}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.burndown.BurnDownSettings",{requires:["Rally.apps.charts.settings.ChartDisplayTypePicker","Rally.apps.charts.settings.DataTypePicker","Rally.apps.charts.settings.TimeboxPicker","Rally.ui.CheckboxField"],config:{app:void 0},constructor:function(config){this.mergeConfig(config)},_buildSettingsComponent:function(type,label,name){var self=this,componentAdded=function(cmp){this.settingsParent=this.settingsParent||self},settings={xtype:type,label:label,listeners:{added:componentAdded}};return name&&(settings.name=name,settings.cls="settings-"+name),settings},_isOnScopedDashboard:function(){return this.app.isOnScopedDashboard()&&!!this.app.context.getTimeboxScope()},getFields:function(){var dataTypePicker=this._buildSettingsComponent("chartdatatypepicker","Data Type"),displayPicker=this._buildSettingsComponent("chartdisplaytypepicker","Chart Type"),timeboxPicker=this._buildSettingsComponent("charttimeboxpicker","Level"),labelNameVisible=this._buildSettingsComponent("rallycheckboxfield","Show Iteration Labels","showLabels");return this._isOnScopedDashboard()?[dataTypePicker,displayPicker,labelNameVisible]:[timeboxPicker,dataTypePicker,displayPicker,labelNameVisible]}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.burndown.BurnDownChart",{requires:["Rally.ui.chart.Chart"],defaultChartComponentConfig:function(){return{xtype:"rallychart",itemId:"burndownchart",aggregationErrorMessage:"No data to display. Check the data type setting for displaying data based on count versus plan estimate.",storeType:"Rally.data.lookback.SnapshotStore",storeConfig:{find:{_TypeHierarchy:{$in:[-51038,-51006]},Children:null},fetch:["ScheduleState","PlanEstimate","ObjectId","_ValidFrom","_ValidTo"],hydrate:["ScheduleState"],sort:{_ValidFrom:1},compress:!0,useHttpPost:!0},calculatorType:"Rally.apps.charts.burndown.BurnDownCalculator",calculatorConfig:{timeZone:"GMT",completedScheduleStateNames:null,enableProjections:!0},chartColors:["#005eb8","#8dc63f","#666666","#c0c0c0"],chartConfig:{chart:{zoomType:"xy"},xAxis:{categories:[],tickmarkPlacement:"on",tickInterval:7,title:{text:"Days",margin:12},maxPadding:.25,labels:{x:0,y:20,overflow:"justify"}},yAxis:[],tooltip:{formatter:function(){var floatValue=parseFloat(this.y),value=this.y;return isNaN(floatValue)||(value=Math.floor(100*floatValue)/100),""+this.x+"<br />"+this.series.name+": "+value}},plotOptions:{series:{marker:{enabled:!1,states:{hover:{enabled:!0}}},connectNulls:!0},column:{pointPadding:0,borderWidth:0,stacking:null,shadow:!1}}}}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.burndown.BurnDownApp",{extend:"Rally.app.TimeboxScopedApp",settingsScope:"project",scopeType:"release",requires:["Rally.apps.charts.burndown.BurnDownSettings","Rally.data.wsapi.Store","Rally.util.Help","Rally.ui.combobox.IterationComboBox","Rally.ui.combobox.ReleaseComboBox","Rally.apps.charts.IntegrationHeaders","Rally.apps.charts.burndown.BurnDownChart","Rally.apps.iterationtrackingboard.StatsBanner"],mixins:["Rally.apps.charts.DateMixin"],cls:"burndown-app",items:[{xtype:"container",itemId:"header",cls:"header"}],help:{id:278},scopeObject:void 0,customScheduleStates:null,config:{defaultSettings:{showLabels:!0,chartAggregationType:void 0,chartDisplayType:void 0,chartTimebox:"release",title:""}},chartComponentConfig:void 0,getSettingsFields:function(){return this.chartSettings=this.chartSettings||Ext.create("Rally.apps.charts.burndown.BurnDownSettings",{app:this}),this.chartSettings.getFields()},onScopeChange:function(scope){this.ignoreOnScopeChange||this._rebuildChartForScope(scope.getRecord().get("_ref"))},launch:function(){return this._settingsInvalid()&&this.owner?(this.owner.showSettings(),void 0):(this.customScheduleStates=null,this.chartComponentConfig=Ext.create("Rally.apps.charts.burndown.BurnDownChart",this).defaultChartComponentConfig(),Ext.create("Rally.apps.charts.IntegrationHeaders",this).applyTo(this.chartComponentConfig.storeConfig),this._addHelpComponent(),this._loadUserStoryModel(),this._saveScopeType(),this.callParent(arguments),this.isOnScopedDashboard()||(this.ignoreOnScopeChange=!0,this._getScopePicker().on("ready",this._loadScopePreference,this,{single:!0})),console.log("context in burndown: ",this.context.getTimeboxScope()),this._addStatsBanner(),void 0)},_addStatsBanner:function(){console.log("context in burndown: ",this.getContext().getTimeboxScope()),this.remove("statsBanner"),this.add({xtype:"statsbanner",itemId:"statsBanner",context:this.getContext(),margin:"0 0 5px 0",listeners:{resize:this._resizeGridBoardToFillSpace,scope:this}})},_resizeGridBoardToFillSpace:function(){this.gridboard&&this.gridboard.setHeight(this.getAvailableGridBoardHeight())},getAvailableGridBoardHeight:function(){var height=this.getHeight();return this.down("#statsBanner").rendered&&(height-=this.down("#statsBanner").getHeight()),height},_addHelpComponent:function(){this.down("#header").add(this._buildHelpComponent())},_buildHelpComponent:function(){return Ext.create("Ext.Component",{renderTpl:Rally.util.Help.getIcon({cls:Rally.util.Test.toBrowserTestCssClass(this.help.cls),id:this.help.id})})},_rebuildChartForScope:function(scopeRef){this._destroyChart(),this._saveScopePreference(scopeRef),this._loadScopeObject(scopeRef)},_destroyChart:function(){this.remove("burndownchart")},_saveScopePreference:function(scopeRef){if(!this.isOnScopedDashboard()){var settings={};settings[this._getScopeType()]=scopeRef,Rally.data.PreferenceManager.update({appID:this.getContext().get("appID"),settings:settings,scope:this})}},_loadScopePreference:function(picker){Rally.data.PreferenceManager.load({appID:this.getContext().get("appID"),success:function(preferences){var scopeRef=preferences[this._getScopeType()];if(!scopeRef||"undefined"===scopeRef){var pickerRecord=picker.getRecord();pickerRecord&&(scopeRef=pickerRecord.get("_ref"),this._saveScopePreference(scopeRef))}this.ignoreOnScopeChange=!1,scopeRef&&"undefined"!==scopeRef&&(this._setScopeValue(scopeRef),scopeRef=this._getScopePicker().getValue(),scopeRef&&this._rebuildChartForScope(scopeRef))},scope:this})},_setScopeValue:function(scopeRef){this._getScopePicker().setValue(scopeRef)},_loadTimeboxes:function(){Ext.create("Rally.data.wsapi.Store",{model:this.scopeObject._type,filters:[{property:"Name",operator:"=",value:this.scopeObject.Name},{property:this._getScopeObjectStartDateName(),operator:"=",value:Rally.util.DateTime.toIsoString(this._getScopeObjectStartDate(),!0)},{property:this._getScopeObjectEndDateName(),operator:"=",value:Rally.util.DateTime.toIsoString(this._getScopeObjectEndDate(),!0)}],context:this.getContext().getDataContext(),fetch:["ObjectID"],limit:1/0,autoLoad:!0,listeners:{load:function(store,records){this._getTimeboxesInScope(store,records)},scope:this}})},_onScopeObjectLoaded:function(record){this._setScopeFromData(record),this._updateChartTitle(),this._updateYAxis(),this._addDateBounds(),this._addAggregationTypeToCalculator(),this._loadTimeboxes()},_renderChartBasedOnType:function(){"release"===this._getScopeType()?this._fetchIterations():null===this.customScheduleStates?this.deferredAddChart=this._addChart:this._addChart()},_setScopeFromData:function(record){this.scopeObject=record.data},_getTimeboxesInScope:function(store,records){var storeConfig=this.chartComponentConfig.storeConfig,type=Ext.String.capitalize(this._getScopeType()),oids=[],i;for(this.timeboxes=store.getItems(),this._clearStoreConfig(storeConfig),i=0;this.timeboxes.length>i;i++)oids.push(this.timeboxes[i].ObjectID);storeConfig.find[type]={$in:oids},this._renderChartBasedOnType()},_addChartWithIterationLines:function(){this._addChart(),this.down("rallychart").on("snapshotsAggregated",this._addIterationLines,this)},_onIterationsLoaded:function(store){this.iterations=store.getItems(),null===this.customScheduleStates?this.deferredAddChart=this._addChartWithIterationLines:this._addChartWithIterationLines()},_addDateBounds:function(){this._addDateBoundsToQuery(),this._addDateBoundsToCalculator()},_addDateBoundsToQuery:function(){},_getNow:function(){return new Date},_addDateBoundsToCalculator:function(){var calcConfig=this.chartComponentConfig.calculatorConfig,endDate=this._getScopeObjectEndDate(),now=this._getNow();calcConfig.startDate=Rally.util.DateTime.toIsoString(this._getScopeObjectStartDate(),!0),now>this._getScopeObjectStartDate()&&this._getScopeObjectEndDate()>now&&(endDate=now),calcConfig.endDate=Rally.util.DateTime.toIsoString(endDate,!0),calcConfig.enableProjections=now>this._getScopeObjectEndDate()?!1:!0,calcConfig.scopeEndDate=this._getScopeObjectEndDate()},_addAggregationTypeToCalculator:function(){var calcConfig=this.chartComponentConfig.calculatorConfig;calcConfig.chartAggregationType=this.getSetting("chartAggregationType")},_updateCompletedScheduleStates:function(){var calcConfig=this.chartComponentConfig.calculatorConfig;calcConfig.completedScheduleStateNames=this.customScheduleStates},_loadScopeObject:function(scopeRef){Rally.data.ModelFactory.getModel({type:this._getScopeType(),context:{workspace:this.getContext().getWorkspaceRef(),project:null},success:function(model){model.load(Rally.util.Ref.getOidFromRef(scopeRef),{success:function(record){this._onScopeObjectLoaded(record)},scope:this})},scope:this})},_fetchIterations:function(){var store=Ext.create("Rally.data.wsapi.Store",{model:Ext.identityFn("Iteration"),filters:[{property:"StartDate",operator:">=",value:Rally.util.DateTime.toIsoString(this._getScopeObjectStartDate(),!0)},{property:"EndDate",operator:"<=",value:Rally.util.DateTime.toIsoString(this._getScopeObjectEndDate(),!0)}],context:{workspace:this.getContext().getWorkspaceRef(),project:this.getContext().getProjectRef()},fetch:["Name","StartDate","EndDate"],limit:1/0});store.on("load",this._onIterationsLoaded,this),store.load()},_areIterationsEqual:function(iteration1,iteration2){return iteration1.Name===iteration2.Name&&iteration1.StartDate===iteration2.StartDate&&iteration1.EndDate===iteration2.EndDate},_addIterationLines:function(chart){var axis=chart.chartConfig.xAxis,categories=chart.chartData.categories,i,j,uniqueIterations=[],unique;for(axis.plotLines=[],axis.plotBands=[],i=0;this.iterations.length>i;i++){for(unique=!0,j=0;uniqueIterations.length>j;j++)if(this._areIterationsEqual(uniqueIterations[j],this.iterations[i])){unique=!1;break}unique===!0&&uniqueIterations.push(this.iterations[i])}for(i=0;uniqueIterations.length>i;i++)axis.plotLines.push(this._getPlotLine(categories,uniqueIterations[i],!1)),axis.plotBands.push(this._getPlotBand(categories,uniqueIterations[i],0!==i%2));uniqueIterations.length>0&&axis.plotLines.push(this._getPlotLine(categories,uniqueIterations[uniqueIterations.length-1],!0))},_buildLabelText:function(iteration){var labelSetting=this.getSetting("showLabels"),text="";return labelSetting&&(text=iteration.Name||""),text},_getPlotBand:function(categories,iteration,shouldColorize){var startDate=this.dateStringToObject(iteration.StartDate),endDate=this.dateStringToObject(iteration.EndDate),label={text:this._buildLabelText(iteration),align:"center",rotation:0,y:-7};return{color:shouldColorize?"#F2FAFF":"#FFFFFF",from:this._getNearestWorkday(categories,startDate),to:this._getNearestWorkday(categories,endDate),label:label}},_getNearestWorkday:function(categories,date){var dateStr=Ext.Date.format(date,"Y-m-d"),index=categories.indexOf(dateStr);if(-1===index){var workdays=this._getWorkspaceConfiguredWorkdays();if(1>workdays.length)return-1;for(;-1===workdays.indexOf(Ext.Date.format(date,"l"))&&date>this._getScopeObjectStartDate();)date=Ext.Date.add(date,Ext.Date.DAY,-1),dateStr=Ext.Date.format(date,"Y-m-d"),index=categories.indexOf(dateStr)}return index},_getPlotLine:function(categories,iteration,lastLine){var dateObj,dateIndex;return dateObj=lastLine?this.dateStringToObject(iteration.EndDate):this.dateStringToObject(iteration.StartDate),dateIndex=this._getNearestWorkday(categories,dateObj),{color:"#BBBBBB",dashStyle:"ShortDash",width:2,zIndex:3,value:dateIndex}},_addChart:function(){this._updateCompletedScheduleStates(),this._updateChartConfigDateFormat(),this._updateChartConfigWorkdays();var chartComponentConfig=Ext.Object.merge({},this.chartComponentConfig);this.add(chartComponentConfig),this.down("rallychart").on("snapshotsAggregated",this._onSnapshotDataReady,this)},_onSnapshotDataReady:function(chart){this._updateDisplayType(chart),this._updateXAxis(chart)},_updateDisplayType:function(chart){var series=chart.chartData.series,displayType=this.getSetting("chartDisplayType"),i;for(i=0;series.length>i;i++)this._seriesFollowsDisplayType(series[i])&&(series[i].type=displayType)},_seriesFollowsDisplayType:function(series){return-1===series.name.indexOf("Ideal")&&-1===series.name.indexOf("Prediction")},_updateYAxis:function(){this._updateYAxisTitle(),this._updateYAxisConfig()},_updateYAxisTitle:function(){var chartConfig=this.chartComponentConfig.chartConfig;chartConfig.yAxis=[{}],chartConfig.yAxis[0].title={text:this._getAxisTitleBasedOnAggregationType()}},_updateYAxisConfig:function(){var axis=this.chartComponentConfig.chartConfig.yAxis[0];axis.min=0,axis.labels={x:-5,y:4}},_updateXAxis:function(chart){1e3>this.container.dom.offsetWidth&&(chart.chartConfig.xAxis.labels.staggerLines=2),chart.chartConfig.xAxis.labels.step=Math.round(chart.chartData.categories.length/100),chart.chartConfig.xAxis.tickInterval=this._configureChartTicks(chart.chartData.categories.length)},_configureChartTicks:function(days){var pixelTickWidth=125,appWidth=this.getWidth(),ticks=Math.floor(appWidth/pixelTickWidth);return Math.ceil(days/ticks)},_getAxisTitleBasedOnAggregationType:function(){var aggregationType=this.getSetting("chartAggregationType");return"storycount"===aggregationType?"Count":"Points"},_updateChartConfigDateFormat:function(){var self=this;this.chartComponentConfig.chartConfig.xAxis.labels.formatter=function(){return self._formatDate(self.dateStringToObject(this.value))}},_updateChartConfigWorkdays:function(){this.chartComponentConfig.calculatorConfig.workDays=this._getWorkspaceConfiguredWorkdays().split(",")},_parseRallyDateFormatToHighchartsDateFormat:function(){for(var dateFormat=this._getUserConfiguredDateFormat()||this._getWorkspaceConfiguredDateFormat(),i=0;this.dateFormatters.length>i;i++)dateFormat=dateFormat.replace(this.dateFormatters[i].key,this.dateFormatters[i].value);return dateFormat},_formatDate:function(date){return this.dateFormat||(this.dateFormat=this._parseRallyDateFormatToHighchartsDateFormat()),Highcharts.dateFormat(this.dateFormat,date.getTime())},_getUserConfiguredDateFormat:function(){return this.getContext().getUser().UserProfile.DateFormat},_getWorkspaceConfiguredDateFormat:function(){return this.getContext().getWorkspace().WorkspaceConfiguration.DateFormat},_getWorkspaceConfiguredWorkdays:function(){return this.getContext().getWorkspace().WorkspaceConfiguration.WorkDays},_updateChartTitle:function(){this.chartComponentConfig.chartConfig.title=this._buildChartTitle()},_buildChartTitle:function(){var widthPerCharacter=10,totalCharacters=Math.floor(this.getWidth()/widthPerCharacter),title=this._getDefaultTitle(),align="center";return this.scopeObject&&(title=this.scopeObject.Name),title.length>totalCharacters&&(title=title.substring(0,totalCharacters)+"...",align="left"),{text:title,align:align,margin:30}},_getDefaultTitle:function(){return Ext.String.capitalize(this._getScopeType())},_settingsInvalid:function(){var chartAggregationType=this.getSetting("chartAggregationType"),chartDisplayType=this.getSetting("chartDisplayType"),chartTimebox=this.getSetting("chartTimebox"),invalid=function(value){return!value||"undefined"===value};return invalid(chartAggregationType)||invalid(chartDisplayType)||this._chartTimeboxInvalid(chartTimebox)},_chartTimeboxInvalid:function(chartTimebox){return this.context.getTimeboxScope()?!1:!chartTimebox||"undefined"===chartTimebox},_saveScopeType:function(){this.scopeType=this._getScopeType()},_getScopeType:function(){return this.isOnScopedDashboard()?this._getDashboardScopeType():this._getSavedScopeType()},_getDashboardScopeType:function(){return this.getContext().getTimeboxScope().getType()},_getSavedScopeType:function(){return this.getSetting("chartTimebox")},_getScopePicker:function(){return this.isOnScopedDashboard()?this.getContext().getTimeboxScope():this.down("rally"+this._getScopeType()+"combobox")},_getScopeObjectStartDateName:function(){return this.scopeObject?"release"===this.scopeObject._type?"ReleaseStartDate":"StartDate":""},_getScopeObjectEndDateName:function(){return this.scopeObject?"release"===this.scopeObject._type?"ReleaseDate":"EndDate":""},_getScopeObjectStartDate:function(){return this.scopeObject?"release"===this.scopeObject._type?this.scopeObject.ReleaseStartDate:this.scopeObject.StartDate:this._getNow()},_getScopeObjectEndDate:function(){return this.scopeObject?"release"===this.scopeObject._type?this.scopeObject.ReleaseDate:this.scopeObject.EndDate:this._getNow()},_clearStoreConfig:function(storeConfig){storeConfig.find.hasOwnProperty("Release")&&delete storeConfig.find.Release,storeConfig.find.hasOwnProperty("Iteration")&&delete storeConfig.find.Iteration},_loadUserStoryModel:function(){Rally.data.ModelFactory.getModel({type:"UserStory",context:this._getContext(),success:function(model){this._getScheduleStateValues(model)},scope:this})},_getContext:function(){return{workspace:this.context.getWorkspaceRef(),project:null}},_getScheduleStateValues:function(model){var scheduleStates=model.getField("ScheduleState").getAllowedStringValues();this.customScheduleStates=scheduleStates.slice(scheduleStates.indexOf("Accepted"),scheduleStates.length),this.deferredAddChart&&this.deferredAddChart.call(this)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.burndown.BurnDownCalculator",{extend:"Rally.data.lookback.calculator.TimeSeriesCalculator",mixins:["Rally.apps.charts.DateMixin"],getDerivedFieldsOnInput:function(){var completedStates=this.config.completedScheduleStateNames,aggregationType=this.config.chartAggregationType;return[{as:"RemainingPoints",f:function(snapshot){var ss=snapshot.ScheduleState;if(0>completedStates.indexOf(ss)){if("storycount"===aggregationType)return 1;if(snapshot.PlanEstimate)return snapshot.PlanEstimate}return 0}},{as:"AcceptedPoints",f:function(snapshot){var ss=snapshot.ScheduleState;if(completedStates.indexOf(ss)>-1){if("storycount"===aggregationType)return 1;if(snapshot.PlanEstimate)return snapshot.PlanEstimate}return 0}}]},getMetrics:function(){return[{field:"RemainingPoints",as:"To Do",f:"sum"},{field:"AcceptedPoints",as:"Accepted",f:"sum"}]},getSummaryMetricsConfig:function(){return[{as:"Scope_max",f:function(seriesData){var max=0,i=0;for(i=0;seriesData.length>i;i++)seriesData[i].Accepted+seriesData[i]["To Do"]>max&&(max=seriesData[i].Accepted+seriesData[i]["To Do"]);return max}}]},getDerivedFieldsAfterSummary:function(){return[{as:"Ideal",f:function(row,index,summaryMetrics,seriesData){var max=summaryMetrics.Scope_max,increments=seriesData.length-1,incrementAmount;return 0===increments?max:(incrementAmount=max/increments,Math.floor(100*(max-index*incrementAmount))/100)},display:"line"}]},getProjectionsConfig:function(){var days=(this.scopeEndDate.getTime()-Rally.util.DateTime.fromIsoString(this.startDate).getTime())/864e5,doubleTimeboxEnd=Ext.Date.add(Rally.util.DateTime.fromIsoString(this.startDate),Ext.Date.DAY,2*Math.floor(days)-1),timeboxEnd=Ext.Date.add(this.scopeEndDate,Ext.Date.DAY,-1);return void 0===this.projectionsConfig&&(this.projectionsConfig={doubleTimeboxEnd:doubleTimeboxEnd,timeboxEnd:timeboxEnd,series:[{as:"Prediction",field:"To Do"}],continueWhile:function(point){var dt=Rally.util.DateTime.fromIsoString(point.tick),end=this.series[0].slope>=0?this.timeboxEnd:this.doubleTimeboxEnd;return point.Prediction>0&&end>dt}}),this.projectionsConfig},_firstNonZero:function(data){var i;for(i=0;data.length>i;i++)if(data[i]>0)return i;return 0},_leastSquares:function(todoValues,firstIndex,lastIndex){var n=lastIndex+1-firstIndex,i,sumx=0,sumx2=0,sumy=0,sumy2=0,sumxy=0,slope,yintercept;for(i=firstIndex;lastIndex>=i;i++)sumx+=i,sumx2+=i*i,sumy+=todoValues[i],sumy2+=todoValues[i]*todoValues[i],sumxy+=i*todoValues[i];return slope=(n*sumxy-sumx*sumy)/(n*sumx2-sumx*sumx),yintercept=(sumy*sumx2-sumx*sumxy)/(n*sumx2-sumx*sumx),{slope:slope,yintercept:yintercept}},runCalculation:function(snapshots){var chartData=this.callParent(arguments);if(chartData&&chartData.projections&&chartData.projections.series[0].slope>0){var todoData=chartData.series[0].data,firstTodoIndex=this._firstNonZero(todoData),lastTodoIndex=todoData.length-1-chartData.projections.pointsAddedCount,results=this._leastSquares(todoData,firstTodoIndex,lastTodoIndex);0>=results.slope&&(this.projectionsConfig.series[0].slope=results.slope,chartData=this.callParent(arguments),chartData.series[3].data[firstTodoIndex]=results.slope*firstTodoIndex+results.yintercept+(chartData.series[3].data[lastTodoIndex]-(results.slope*lastTodoIndex+results.yintercept)),chartData.series[3].connectNulls=!0,this.projectionsConfig=void 0)}return new Date<this.scopeEndDate&&this._recomputeIdeal(chartData,this.scopeEndDate),chartData},_recomputeIdeal:function(chartData,endDate){var index;if(!(1>chartData.categories.length||1>this.workDays.length)){var lastDate=Ext.Date.parse(chartData.categories[chartData.categories.length-1],"Y-m-d");if(endDate>lastDate){index=chartData.categories.length;for(var dt=Ext.Date.add(lastDate,Ext.Date.DAY,1);endDate>dt;){for(;-1===this.workDays.indexOf(Ext.Date.format(dt,"l"));)dt=Ext.Date.add(dt,Ext.Date.DAY,1);endDate>dt&&(chartData.categories[index++]=Ext.Date.format(dt,"Y-m-d")),dt=Ext.Date.add(dt,Ext.Date.DAY,1)}index=chartData.categories.length-1}else if(index=this._indexOfDate(chartData,endDate),-1===index)for(;-1===this.workDays.indexOf(Ext.Date.format(endDate,"l"));)endDate=Ext.Date.add(endDate,Ext.Date.DAY,-1),index=this._indexOfDate(chartData,endDate);if(!(0>index)){var i,seriesData=chartData.series[2].data;for(i=1;index>i;i++)seriesData[i]=null;seriesData[index]=0}}},_indexOfDate:function(chartData,date){var dateStr=Ext.Date.format(date,"Y-m-d");return chartData.categories.indexOf(dateStr)},_removeFutureSeries:function(chartData,seriesIndex,dayIndex){if(chartData.series[seriesIndex].data.length>dayIndex)for(;++dayIndex<chartData.series[seriesIndex].data.length;)chartData.series[seriesIndex].data[dayIndex]=null},_projectionsSlopePositive:function(chartData){return chartData.projections&&chartData.projections.series?chartData.projections.series[0].slope>=0:!0}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Rally.apps.charts.burndown.ReleaseBurnDownApp",{extend:"Rally.apps.charts.burndown.BurnDownApp",help:{id:278},integrationHeaders:{name:"Release Burndown"}})})();

            Rally.launchApp('Rally.apps.charts.burndown.ReleaseBurnDownApp', {
                name:"Release Burndown",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        @grey1: #F6F6F6;
@grey2: #E6E6E6;
@grey3: #D6D6D6;
@grey4: #C0C0C0;
@grey6: #888888;
@grey7: #666666;
@grey8: #444444;
@grey9: #222222;
@lime: #8DC63F;
@cyan: #00A9E0;
@proxima-nova-semi-bold: ProximaNovaSemiBold, Helvetica, Arial;
@proxima-nova-light: ProximaNovaLight, Helvetica, Arial;
@proxima-nova: ProximaNova, Helvetica, Arial;
    </style>
    <style type="text/css">
        @import "RallyVariables.less";

.border-radius(@radius) {
  -webkit-border-radius: @radius;
  -moz-border-radius: @radius;
  border-radius: @radius;
}

.override-ext-container() {
  > span {
    display: inline !important;
    width: auto !important;

    > div {
      display: block !important;
    }
  }
}

.stat-panel {
  .collapsed-widget,
  .collapsed-widget > div {
    display: none;
  }

  .expanded-widget,
  .expanded-widget > div {
    display: block;
  }

  &.collapsed {
    .collapsed-widget,
    .collapsed-widget > div {
      display: inline-block;
    }

    .expanded-widget,
    .expanded-widget > div {
      display: none;
    }
  }
}

.stats-banner {

  .stat-panel {
    border-left: 1px solid @grey3;
    height: 110px;
    text-align: center;

    &:first-child {
      border-left: 0;
    }

    &:last-child {
      border-left-width: 2px;
    }

    .stat-title {
      color: @grey9;
      font-family: @proxima-nova-semi-bold;
      font-size: 14px;
      padding-top: 5px;
    }

    .stat-metric {
      color: @grey7;
      font-family: @proxima-nova-light;
      font-size: 18px;
      height: 85px;
      padding-top: 20px;

      .metric-percent {
        display: inline;
        font-size: 12px;
        vertical-align: super;
      }

      .metric-icon {
        color: @grey6;
        font-size: 18px;
        padding-right: 5px;
      }

      .metric-chart {
        position: absolute;
        top: 22px;
        width: 100%;
      }

      .metric-subtext {
        bottom: 7px;
        color: @grey6;
        font-family: @proxima-nova;
        font-size: 11px;
        position: absolute;
        text-transform: lowercase;
        width: 100%;
      }

      .metric-chart-text {
        position: absolute;
        top: 43px;
        width: 100%;

        &.percent-offset {
          left: 3px;
          top: 41px;
        }
      }

      .stat-secondary {
        color: @grey6;
        font-family: @proxima-nova;
        font-size: 11px;
        text-transform: lowercase;
      }

      .stat-carousel {
        display:inline-block;
        font-family: @proxima-nova;
        font-size: 12px;
        margin-top: -20px;

        .rally-carousel-pane {
          .@{prefix}box-inner {
            top: 0px !important;
          }
        }

        .rly-carousel {
          .override-ext-container();

          .carousel-panel {
            .override-ext-container();
          }
        }
      }
    }

    .chart .highcharts-container {
      cursor: pointer;
    }

    .gauge .chart .highcharts-container {
      cursor: default;
    }

    .header {
      display:none;
    }

    &.collapse-expand {
      background-color: @grey1;
      width: 23px;

      .toggle-icon {
        color: @grey4;
        font-size: 15px;
        padding-top: 4px;
        position: relative;
        right: 1px;
      }

      &:hover {
        cursor: pointer;

        .toggle-icon {
          color: @grey8;
        }
      }
    }
  }

  &.collapsed {
    cursor: pointer;

    .stat-panel {
      height: 25px;
      padding-top: 2px;

      &.collapse-expand {
        .toggle-icon {
          padding-top: 2px;
        }
      }

      .metric-icon {
        color: @grey6;
        font-size: 14px;
        padding-right: 5px;
        vertical-align: middle;
      }

      .stat-title {
        color: @grey9;
        display: inline;
        font-family: @proxima-nova-semi-bold;
        font-size: 12px;
        vertical-align: middle;
      }

      .stat-metric {
        color: @grey6;
        display: inline;
        font-family: @proxima-nova;
        font-size: 14px;
        height: auto;
        padding-top: auto;
        padding-left: 10px;
        vertical-align: middle;

        .stat-metric-secondary {
          font-size: 11px;
        }

        .metric-percent {
          font-size: 10px;
          vertical-align: super;
        }
      }
    }
  }
}

.pie-chart-legend {
  color: #3E576F;
  font-size: 12px;
  padding: 5px;
  border: 1px solid #909090;
  .border-radius(5px);

  .legend-swatch {
    width: 17px;
    height: 12px;
    border: 1px solid #EEE;
    .border-radius(5px);
    float: left;
    margin: 0 3px 0 6px;

    &.defined-sample-swatch {
      background: #E0E0E0; /* light-gray */
    }

    &.in-progress-sample-swatch {
      background: @cyan;
    }

    &.completed-sample-swatch {
      background: @lime;
    }

    &.blocked-sample-swatch {
      background: #EF3F35; /* rally red */
    }
  }
}

.iteration-progress-dialog .rly-carousel .carousel-panel .scroll-button span {
  width: 45px;
  height: 50px;
  line-height: 46px;
  &:hover {
    background-color: @grey2;
    color: @grey7;
  }
}

.iteration-progress-toggle-button-group {
  margin-bottom: 5px;
}

.@{prefix}gecko .stats-banner.collapsed {
  .stat-panel {
    .stat-metric {
      line-height: 20px;
      vertical-align: top;

      .metric-percent {
        line-height: 10px;
      }
    }
  }
}

.@{prefix}gecko.@{prefix}mac .stats-banner.collapsed {
  .stat-panel {
    .stat-metric {
      line-height: 22px;
    }
  }
}
    </style>
    <style type="text/css">
        .burndown-app .chartControls,
.app-settings .settings-form .paddedSettingCmp {
    margin: 15px;
    border: 0px;
}

.burndown-app .chartControls .rui-triggerfield {
    display: inline-block;
}

.burndown-app .chartControls label {
    display: inline-block;
    font-size: 1.2em;
    margin: 3px 8px;
}

.portfolio-cfd-app,
.portfolio-burnup-app,
.burndown-app {
    margin: 10px;
    padding-right: 20px;
    background-color: transparent;
}

.portfolio-cfd-app .rally-help-icon,
.burndown-app .rally-help-icon,
.portfolio-burnup-app .rally-help-icon,
.chart-app .rally-help-icon {
    float: right;
}

.portfolio-cfd-app .chart,
.portfolio-burnup-app .chart {
    min-height: 2em;
}

.app-settings .settings-form .piButton {
    padding: 5px 15px 7px 15px;
    z-index: 101;
    margin-bottom: 10px;
}

.app-settings .settings-form .piDisplayField {
    background-color: #e2eff6;
    margin-left: -10px;
    min-width: 250px;
    padding: 5px 20px 3px 25px;
    z-index: 100;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
}

.app-settings .settings-form .settingsLabel {
    display: block;
    font-family: NotoSansBold, Helvetica, Arial;
    font-weight: normal;
    min-height: 20px;
    text-transform: uppercase;
    width: 100px;
}

table.settings-showLabels label {
    white-space: nowrap;
    width: auto;
}
table.settings-showLabels td {
    width:130px;
}

.schedule-state-selector .@{prefix}boundlist-selected .@{prefix}form-checkbox {
    background-position: 0 -13px;
}

.statefieldvalue-boundlist-item img.stateFieldValue {
    background: transparent url('checkbox.gif');
    height: 13px;
    width: 13px;
}
.statefieldvalue-boundlist-selected img.stateFieldValue{
    background: transparent url('checkbox.gif');
    height: 13px;
    width: 13px;
    background-position-x: 0px;
    background-position-y: -13px;
}

    </style>
</head>
<body></body>
</html>
